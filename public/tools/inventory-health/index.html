<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Health Monitor | Glue Masters</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #0f1419;
            --bg-card: #1c2128;
            --bg-input: #2d333b;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-yellow: #d29922;
            --accent-red: #f85149;
            --accent-purple: #a371f7;
            --accent-orange: #f0883e;
            --border: #30363d;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.5;
            padding: 20px;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-actions { display: flex; gap: 12px; }
        
        button {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        button:hover { background: var(--border); }
        button.primary { background: var(--accent-blue); border-color: var(--accent-blue); color: #fff; }
        button.primary:hover { background: #4393e6; }
        
        /* Alert Banner */
        .alert-banner {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--accent-red);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert-banner.warning {
            background: rgba(210, 153, 34, 0.1);
            border-color: var(--accent-yellow);
        }
        
        .alert-banner.good {
            background: rgba(63, 185, 80, 0.1);
            border-color: var(--accent-green);
        }
        
        .alert-icon { font-size: 24px; }
        .alert-content { flex: 1; }
        .alert-title { font-weight: 600; margin-bottom: 4px; }
        .alert-desc { font-size: 14px; color: var(--text-secondary); }
        
        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .summary-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .summary-value.good { color: var(--accent-green); }
        .summary-value.warning { color: var(--accent-yellow); }
        .summary-value.bad { color: var(--accent-red); }
        
        .summary-label {
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        /* Inventory Table */
        .inventory-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border);
        }
        
        .section-header h2 {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            background: var(--bg-input);
        }
        
        tr:last-child td { border-bottom: none; }
        
        tr:hover { background: rgba(88, 166, 255, 0.05); }
        
        .sku-name {
            font-weight: 500;
        }
        
        .sku-asin {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .status-badge {
            display: inline-block;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 500;
        }
        
        .status-badge.healthy { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
        .status-badge.low { background: rgba(210, 153, 34, 0.2); color: var(--accent-yellow); }
        .status-badge.critical { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
        .status-badge.oos { background: var(--accent-red); color: #fff; }
        .status-badge.stranded { background: rgba(163, 113, 247, 0.2); color: var(--accent-purple); }
        .status-badge.suppressed { background: rgba(240, 136, 62, 0.2); color: var(--accent-orange); }
        
        .qty-cell {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 14px;
        }
        
        .qty-cell.zero { color: var(--accent-red); }
        
        /* Days of Stock Bar */
        .dos-bar {
            height: 8px;
            background: var(--bg-input);
            border-radius: 4px;
            overflow: hidden;
            min-width: 80px;
        }
        
        .dos-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .dos-fill.good { background: var(--accent-green); }
        .dos-fill.warning { background: var(--accent-yellow); }
        .dos-fill.critical { background: var(--accent-red); }
        
        /* Issue Cards */
        .issue-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .issue-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        
        .issue-card h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        .issue-count {
            font-size: 12px;
            padding: 2px 8px;
            background: var(--bg-input);
            border-radius: 10px;
            margin-left: auto;
        }
        
        .issue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .issue-item:last-child { border-bottom: none; }
        
        .issue-sku {
            font-weight: 500;
            font-size: 14px;
        }
        
        .issue-detail {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Data Entry Form */
        .entry-form {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .form-group label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        .form-group input, .form-group select {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        /* Charts */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        
        .chart-card h3 {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 16px;
        }
        
        .chart-container {
            height: 220px;
            position: relative;
        }
        
        /* Quick Links */
        .quick-links {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 24px;
        }
        
        .quick-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .quick-link:hover {
            border-color: var(--accent-blue);
            background: var(--bg-input);
        }
        
        /* Preload Notice */
        .preload-notice {
            background: rgba(163, 113, 247, 0.1);
            border: 1px solid var(--accent-purple);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .preload-notice strong { color: var(--accent-purple); }
        
        @media (max-width: 768px) {
            .chart-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì¶ Inventory Health Monitor</h1>
            <div class="header-actions">
                <button onclick="exportReport()">üìÑ Export</button>
                <button onclick="clearData()">üóëÔ∏è Clear</button>
                <button class="primary" onclick="saveData()">üíæ Save</button>
            </div>
        </header>
        
        <div class="preload-notice">
            <strong>üéØ Purpose:</strong> Track FBA inventory health to diagnose "spread" issues. 
            Low/stranded/suppressed inventory = reduced national availability = lower BSR.
        </div>
        
        <!-- Alert Banner -->
        <div class="alert-banner warning" id="alertBanner">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <div class="alert-content">
                <div class="alert-title">Inventory Issues Detected</div>
                <div class="alert-desc" id="alertDesc">2 SKUs with low stock, 1 OOS, 1 stranded</div>
            </div>
        </div>
        
        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card">
                <div class="summary-value good" id="totalSkus">10</div>
                <div class="summary-label">Active SKUs</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="healthyCount">6</div>
                <div class="summary-label">Healthy</div>
            </div>
            <div class="summary-card">
                <div class="summary-value warning" id="lowCount">2</div>
                <div class="summary-label">Low Stock</div>
            </div>
            <div class="summary-card">
                <div class="summary-value bad" id="criticalCount">1</div>
                <div class="summary-label">Critical/OOS</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="strandedCount">1</div>
                <div class="summary-label">Stranded</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="avgDos">42</div>
                <div class="summary-label">Avg Days of Stock</div>
            </div>
        </div>
        
        <!-- Add/Edit SKU Form -->
        <div class="entry-form">
            <h3 style="margin-bottom: 16px; font-size: 14px; color: var(--text-secondary);">‚ûï ADD/UPDATE SKU DATA</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>SKU Name</label>
                    <input type="text" id="skuName" placeholder="e.g., 2oz Thin">
                </div>
                <div class="form-group">
                    <label>ASIN</label>
                    <input type="text" id="skuAsin" placeholder="B01...">
                </div>
                <div class="form-group">
                    <label>FBA Available</label>
                    <input type="number" id="fbaAvailable" placeholder="0">
                </div>
                <div class="form-group">
                    <label>FBA Inbound</label>
                    <input type="number" id="fbaInbound" placeholder="0">
                </div>
                <div class="form-group">
                    <label>FBA Reserved</label>
                    <input type="number" id="fbaReserved" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Stranded</label>
                    <input type="number" id="fbaStranded" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Avg Daily Sales</label>
                    <input type="number" id="avgDailySales" step="0.1" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="skuStatus">
                        <option value="active">Active</option>
                        <option value="suppressed">Suppressed</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
            <button class="primary" style="margin-top: 16px;" onclick="addSku()">Add/Update SKU</button>
        </div>
        
        <!-- Issue Cards -->
        <div class="issue-grid">
            <div class="issue-card">
                <h3>
                    üî¥ Out of Stock
                    <span class="issue-count" id="oosIssueCount">0</span>
                </h3>
                <div id="oosIssues">
                    <div style="color: var(--text-secondary); font-size: 14px;">No OOS items</div>
                </div>
            </div>
            
            <div class="issue-card">
                <h3>
                    üü° Low Stock (&lt;14 days)
                    <span class="issue-count" id="lowIssueCount">0</span>
                </h3>
                <div id="lowStockIssues">
                    <div style="color: var(--text-secondary); font-size: 14px;">No low stock items</div>
                </div>
            </div>
            
            <div class="issue-card">
                <h3>
                    üü£ Stranded Inventory
                    <span class="issue-count" id="strandedIssueCount">0</span>
                </h3>
                <div id="strandedIssues">
                    <div style="color: var(--text-secondary); font-size: 14px;">No stranded items</div>
                </div>
            </div>
            
            <div class="issue-card">
                <h3>
                    üü† Suppressed Listings
                    <span class="issue-count" id="suppressedIssueCount">0</span>
                </h3>
                <div id="suppressedIssues">
                    <div style="color: var(--text-secondary); font-size: 14px;">No suppressed listings</div>
                </div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="chart-grid">
            <div class="chart-card">
                <h3>üìä Days of Stock by SKU</h3>
                <div class="chart-container">
                    <canvas id="dosChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>üìà Inventory Status Distribution</h3>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Full Inventory Table -->
        <div class="inventory-section">
            <div class="section-header">
                <h2>üìã Full Inventory Detail</h2>
                <button onclick="refreshTable()">üîÑ Refresh</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>SKU / ASIN</th>
                        <th>Available</th>
                        <th>Inbound</th>
                        <th>Reserved</th>
                        <th>Stranded</th>
                        <th>Daily Sales</th>
                        <th>Days of Stock</th>
                        <th>Status</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="inventoryTable">
                    <!-- Populated dynamically -->
                </tbody>
            </table>
        </div>
        
        <!-- Quick Links -->
        <div class="quick-links">
            <a class="quick-link" href="https://sellercentral.amazon.com/inventoryplanning/dashboard" target="_blank">
                üìä Inventory Dashboard
            </a>
            <a class="quick-link" href="https://sellercentral.amazon.com/inventory?viewId=STRANDED" target="_blank">
                üü£ Fix Stranded Inventory
            </a>
            <a class="quick-link" href="https://sellercentral.amazon.com/inventory?viewId=FBA" target="_blank">
                üì¶ FBA Inventory
            </a>
            <a class="quick-link" href="https://sellercentral.amazon.com/listing/quality-dashboard" target="_blank">
                ‚úÖ Listing Quality Dashboard
            </a>
            <a class="quick-link" href="https://sellercentral.amazon.com/restockinventory" target="_blank">
                üì• Restock Inventory
            </a>
        </div>
    </div>
    
    <script>
        // Preloaded Glue Masters SKU data
        let skus = [
            { name: '2oz Thin', asin: 'B01M8JT9LI', available: 245, inbound: 0, reserved: 12, stranded: 0, avgDailySales: 8.2, status: 'active' },
            { name: '2oz Medium', asin: 'B01MDNS8QB', available: 189, inbound: 500, reserved: 8, stranded: 0, avgDailySales: 6.5, status: 'active' },
            { name: '2oz Thick', asin: 'B01M3XJ1DR', available: 312, inbound: 0, reserved: 15, stranded: 0, avgDailySales: 5.8, status: 'active' },
            { name: '8oz Thin', asin: 'B01MDNUQB8', available: 67, inbound: 200, reserved: 3, stranded: 0, avgDailySales: 3.2, status: 'active' },
            { name: '8oz Medium', asin: 'B01MFXL0P3', available: 45, inbound: 0, reserved: 2, stranded: 0, avgDailySales: 2.8, status: 'active' },
            { name: '8oz Thick', asin: 'B01M5CHQJ6', available: 89, inbound: 150, reserved: 4, stranded: 0, avgDailySales: 2.1, status: 'active' },
            { name: '16oz Medium', asin: 'B01LVTLBSV', available: 23, inbound: 0, reserved: 1, stranded: 0, avgDailySales: 1.5, status: 'active' },
            { name: '16oz Thick', asin: 'B01M8K0QT8', available: 34, inbound: 100, reserved: 2, stranded: 0, avgDailySales: 1.2, status: 'active' },
            { name: 'Accelerator 2oz', asin: 'B00PR0LK7A', available: 0, inbound: 500, reserved: 0, stranded: 0, avgDailySales: 3.8, status: 'active' },
            { name: 'Debonder', asin: 'B01N9P8YJK', available: 156, inbound: 0, reserved: 5, stranded: 24, avgDailySales: 2.4, status: 'active' },
        ];
        
        let dosChart = null;
        let statusChart = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderAll();
            initCharts();
        });
        
        function calculateDos(sku) {
            if (sku.avgDailySales <= 0) return 999;
            return Math.round(sku.available / sku.avgDailySales);
        }
        
        function getStockStatus(sku) {
            const dos = calculateDos(sku);
            if (sku.status === 'suppressed') return 'suppressed';
            if (sku.available === 0) return 'oos';
            if (sku.stranded > 0) return 'stranded';
            if (dos < 7) return 'critical';
            if (dos < 14) return 'low';
            return 'healthy';
        }
        
        function renderAll() {
            renderTable();
            renderSummary();
            renderIssues();
            updateAlert();
            updateCharts();
        }
        
        function renderTable() {
            const tbody = document.getElementById('inventoryTable');
            tbody.innerHTML = skus.map((sku, i) => {
                const dos = calculateDos(sku);
                const status = getStockStatus(sku);
                const dosPct = Math.min(100, (dos / 60) * 100);
                const dosClass = dos < 7 ? 'critical' : dos < 14 ? 'warning' : 'good';
                
                return `
                    <tr>
                        <td>
                            <div class="sku-name">${sku.name}</div>
                            <div class="sku-asin">${sku.asin}</div>
                        </td>
                        <td class="qty-cell ${sku.available === 0 ? 'zero' : ''}">${sku.available}</td>
                        <td class="qty-cell">${sku.inbound || '-'}</td>
                        <td class="qty-cell">${sku.reserved || '-'}</td>
                        <td class="qty-cell ${sku.stranded > 0 ? 'zero' : ''}">${sku.stranded || '-'}</td>
                        <td class="qty-cell">${sku.avgDailySales.toFixed(1)}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="min-width: 40px;">${dos > 90 ? '90+' : dos}</span>
                                <div class="dos-bar">
                                    <div class="dos-fill ${dosClass}" style="width: ${dosPct}%"></div>
                                </div>
                            </div>
                        </td>
                        <td><span class="status-badge ${status}">${status}</span></td>
                        <td>
                            <button onclick="editSku(${i})" style="padding: 4px 8px; font-size: 12px;">‚úèÔ∏è</button>
                            <button onclick="deleteSku(${i})" style="padding: 4px 8px; font-size: 12px;">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderSummary() {
            const counts = { healthy: 0, low: 0, critical: 0, oos: 0, stranded: 0, suppressed: 0 };
            let totalDos = 0;
            
            skus.forEach(sku => {
                const status = getStockStatus(sku);
                counts[status] = (counts[status] || 0) + 1;
                if (sku.stranded > 0) counts.stranded++;
                totalDos += Math.min(90, calculateDos(sku));
            });
            
            document.getElementById('totalSkus').textContent = skus.length;
            document.getElementById('healthyCount').textContent = counts.healthy;
            document.getElementById('lowCount').textContent = counts.low;
            document.getElementById('criticalCount').textContent = counts.critical + counts.oos;
            document.getElementById('strandedCount').textContent = counts.stranded;
            document.getElementById('avgDos').textContent = skus.length > 0 ? Math.round(totalDos / skus.length) : 0;
        }
        
        function renderIssues() {
            const oos = skus.filter(s => s.available === 0);
            const low = skus.filter(s => calculateDos(s) < 14 && s.available > 0);
            const stranded = skus.filter(s => s.stranded > 0);
            const suppressed = skus.filter(s => s.status === 'suppressed');
            
            renderIssueList('oosIssues', 'oosIssueCount', oos, s => `${s.inbound || 0} inbound`);
            renderIssueList('lowStockIssues', 'lowIssueCount', low, s => `${calculateDos(s)} days left`);
            renderIssueList('strandedIssues', 'strandedIssueCount', stranded, s => `${s.stranded} units`);
            renderIssueList('suppressedIssues', 'suppressedIssueCount', suppressed, s => 'Needs fix');
        }
        
        function renderIssueList(containerId, countId, items, detailFn) {
            document.getElementById(countId).textContent = items.length;
            const container = document.getElementById(containerId);
            
            if (items.length === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); font-size: 14px;">None detected ‚úì</div>';
                return;
            }
            
            container.innerHTML = items.map(item => `
                <div class="issue-item">
                    <div>
                        <div class="issue-sku">${item.name}</div>
                        <div class="issue-detail">${item.asin}</div>
                    </div>
                    <span class="status-badge low">${detailFn(item)}</span>
                </div>
            `).join('');
        }
        
        function updateAlert() {
            const banner = document.getElementById('alertBanner');
            const desc = document.getElementById('alertDesc');
            
            const oos = skus.filter(s => s.available === 0).length;
            const low = skus.filter(s => calculateDos(s) < 14 && s.available > 0).length;
            const stranded = skus.filter(s => s.stranded > 0).length;
            const suppressed = skus.filter(s => s.status === 'suppressed').length;
            
            const issues = [];
            if (oos > 0) issues.push(`${oos} OOS`);
            if (low > 0) issues.push(`${low} low stock`);
            if (stranded > 0) issues.push(`${stranded} stranded`);
            if (suppressed > 0) issues.push(`${suppressed} suppressed`);
            
            if (issues.length === 0) {
                banner.className = 'alert-banner good';
                banner.querySelector('.alert-icon').textContent = '‚úÖ';
                banner.querySelector('.alert-title').textContent = 'All Inventory Healthy';
                desc.textContent = 'No issues detected';
            } else if (oos > 0 || suppressed > 0) {
                banner.className = 'alert-banner';
                banner.querySelector('.alert-icon').textContent = 'üö®';
                banner.querySelector('.alert-title').textContent = 'Critical Inventory Issues';
                desc.textContent = issues.join(', ');
            } else {
                banner.className = 'alert-banner warning';
                banner.querySelector('.alert-icon').textContent = '‚ö†Ô∏è';
                banner.querySelector('.alert-title').textContent = 'Inventory Issues Detected';
                desc.textContent = issues.join(', ');
            }
        }
        
        function initCharts() {
            // Days of Stock Chart
            const dosCtx = document.getElementById('dosChart').getContext('2d');
            dosChart = new Chart(dosCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Days of Stock',
                        data: [],
                        backgroundColor: [],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            max: 90,
                            grid: { color: '#30363d' },
                            ticks: { color: '#8b949e' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#8b949e' }
                        }
                    }
                }
            });
            
            // Status Distribution Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            statusChart = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Healthy', 'Low Stock', 'Critical', 'OOS'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#3fb950', '#d29922', '#f85149', '#8b0000'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#e6edf3' }
                        }
                    }
                }
            });
            
            updateCharts();
        }
        
        function updateCharts() {
            if (!dosChart || !statusChart) return;
            
            // Update DOS chart
            const sortedSkus = [...skus].sort((a, b) => calculateDos(a) - calculateDos(b));
            dosChart.data.labels = sortedSkus.map(s => s.name);
            dosChart.data.datasets[0].data = sortedSkus.map(s => Math.min(90, calculateDos(s)));
            dosChart.data.datasets[0].backgroundColor = sortedSkus.map(s => {
                const dos = calculateDos(s);
                if (dos < 7) return '#f85149';
                if (dos < 14) return '#d29922';
                return '#3fb950';
            });
            dosChart.update();
            
            // Update status chart
            const counts = { healthy: 0, low: 0, critical: 0, oos: 0 };
            skus.forEach(sku => {
                const dos = calculateDos(sku);
                if (sku.available === 0) counts.oos++;
                else if (dos < 7) counts.critical++;
                else if (dos < 14) counts.low++;
                else counts.healthy++;
            });
            statusChart.data.datasets[0].data = [counts.healthy, counts.low, counts.critical, counts.oos];
            statusChart.update();
        }
        
        function addSku() {
            const name = document.getElementById('skuName').value.trim();
            const asin = document.getElementById('skuAsin').value.trim();
            
            if (!name || !asin) {
                alert('SKU Name and ASIN required');
                return;
            }
            
            const skuData = {
                name,
                asin,
                available: parseInt(document.getElementById('fbaAvailable').value) || 0,
                inbound: parseInt(document.getElementById('fbaInbound').value) || 0,
                reserved: parseInt(document.getElementById('fbaReserved').value) || 0,
                stranded: parseInt(document.getElementById('fbaStranded').value) || 0,
                avgDailySales: parseFloat(document.getElementById('avgDailySales').value) || 0,
                status: document.getElementById('skuStatus').value
            };
            
            // Check if exists (update) or new (add)
            const existingIdx = skus.findIndex(s => s.asin === asin);
            if (existingIdx >= 0) {
                skus[existingIdx] = skuData;
            } else {
                skus.push(skuData);
            }
            
            // Clear form
            document.querySelectorAll('.entry-form input').forEach(i => i.value = '');
            document.getElementById('skuStatus').value = 'active';
            
            renderAll();
            saveData();
        }
        
        function editSku(index) {
            const sku = skus[index];
            document.getElementById('skuName').value = sku.name;
            document.getElementById('skuAsin').value = sku.asin;
            document.getElementById('fbaAvailable').value = sku.available;
            document.getElementById('fbaInbound').value = sku.inbound || '';
            document.getElementById('fbaReserved').value = sku.reserved || '';
            document.getElementById('fbaStranded').value = sku.stranded || '';
            document.getElementById('avgDailySales').value = sku.avgDailySales;
            document.getElementById('skuStatus').value = sku.status;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function deleteSku(index) {
            if (!confirm(`Delete ${skus[index].name}?`)) return;
            skus.splice(index, 1);
            renderAll();
            saveData();
        }
        
        function refreshTable() {
            renderAll();
        }
        
        function saveData() {
            localStorage.setItem('inventory-health-data', JSON.stringify(skus));
        }
        
        function loadData() {
            const saved = localStorage.getItem('inventory-health-data');
            if (saved) {
                try {
                    skus = JSON.parse(saved);
                } catch (e) {
                    console.error('Failed to load data');
                }
            }
        }
        
        function clearData() {
            if (!confirm('Reset to default SKU data?')) return;
            localStorage.removeItem('inventory-health-data');
            location.reload();
        }
        
        function exportReport() {
            let report = `# Inventory Health Report\n`;
            report += `Generated: ${new Date().toLocaleString()}\n\n`;
            
            report += `## Summary\n`;
            report += `- Total SKUs: ${skus.length}\n`;
            report += `- OOS: ${skus.filter(s => s.available === 0).length}\n`;
            report += `- Low Stock (<14 days): ${skus.filter(s => calculateDos(s) < 14 && s.available > 0).length}\n`;
            report += `- Stranded: ${skus.filter(s => s.stranded > 0).length}\n\n`;
            
            report += `## SKU Detail\n\n`;
            report += `| SKU | ASIN | Available | DOS | Status |\n`;
            report += `|-----|------|-----------|-----|--------|\n`;
            skus.forEach(sku => {
                report += `| ${sku.name} | ${sku.asin} | ${sku.available} | ${calculateDos(sku)} | ${getStockStatus(sku)} |\n`;
            });
            
            const blob = new Blob([report], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventory-health-${new Date().toISOString().split('T')[0]}.md`;
            a.click();
        }
    </script>
</body>
</html>
